<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Jasmine Spec Runner</title>
    
    <link rel="stylesheet" type="text/css" href="jasmine/jasmine.css">
    
    <script src="../vendor/require.js"></script>
    <script src="jasmine/jasmine.js"></script>
    <script src="jasmine/jasmine-html.js"></script>
    <!--
        Note: boot.js file was sligltly modified to work with AMD modules.
        It by default starts with window.onload, what is not good for us, because
        then none of AMD modules are loaded yet. So the method is just renamed
        to window.startJasmine, and called manually after requirejs finished
        loadig all the stuff.
    -->
    <script src="jasmine/boot.js"></script>
    
    <script>
        
        // Catch all uncought node.js errors and report them to the console.
        process.on('uncaughtException', function(err) {
            console.log(err);
        });
        
        // This is automatic spec loader.
        // All files with extension ".spec.js", will be loaded and executed as specs,
        // so you don't have to declare them here in any way.
        var fs = require('fs');
        var specPaths = [];
        
        // Directory names where specs will not be searched.
        var blacklisted = ['node_modules'];
        
        var parseDir = function (path) {
            var files = fs.readdirSync(path);
            files.forEach(function (filename) {
                var childPath = path + '/' + filename;
                if (childPath.match(/\.spec\.js$/)) {
                    var moduleName = childPath.replace(/\.js$/, '');
                    specPaths.push(moduleName);
                } else {
                    var stat = fs.statSync(childPath);
                    if (stat.isDirectory() && blacklisted.indexOf(filename) === -1) {
                        parseDir(childPath);
                    }
                }
            });
        };
        
        parseDir('.');
        
        requirejs.config({
            baseUrl: '../' // Base URL set to app directory.
        });
        
        requirejs(specPaths, function () {
            window.startJasmine();
        });
        
    </script>
    
</head>
<body>
</body>
</html>
